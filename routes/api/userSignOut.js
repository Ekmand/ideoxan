/* ---------------------------------------------------------------------------------------------- */
/*                                             MODULES                                            */
/* ---------------------------------------------------------------------------------------------- */
/* ------------------------------------------- Models ------------------------------------------- */
const Users                     = require(serverConfig.paths.models + '/User')
/* --------------------------------------- Authentication --------------------------------------- */
const passport                  = require('passport')
const bcrypt                    = require('bcryptjs')
/* ------------------------------------------ Utilities ----------------------------------------- */
const { isAuth }                = require(serverConfig.paths.middleware + '/authChecker')


/* ---------------------------------------------------------------------------------------------- */
/*                                         INITIALIZATION                                         */
/* ---------------------------------------------------------------------------------------------- */
/* ------------------------------------------ Endpoint ------------------------------------------ */
exports.route = 'user/deauth/'
/* ----------------------------------------- Middlewares ---------------------------------------- */
exports.handlers = []
exports.handlers.get = [
    isAuth,
]


/* ---------------------------------------------------------------------------------------------- */
/*                                           CONTROLLER                                           */
/* ---------------------------------------------------------------------------------------------- */
exports.get = (req, res, next) => {
    try {
        req.logOut()
        if (req.session) req.session.destroy()
        if (req.accepts('html')) {
            res.redirect('/')
        }
    } catch (err) {
        next(err)
    }
}